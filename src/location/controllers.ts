import { Request, Response } from 'express';import {LocationType, LocationGoodType, PerkType, Perk} from '@prisma/client';import {	completeLocationPaperwork, createReservation, deleteReservation,	estimateLocationPrice,	getLocation, getLocationDetail, getLocationReservations,	getLocationsPendingPublish,	getLocationsToReview,	getPublishedLocations, getRentorReservationsForLocation,	getUserPublishedLocations,	publishLocation,	registerLocationPerks,	removeDocument,	saveLocation,	uploadLocationImageAsImage,	uploadLocationImageAsPaperAsset} from "./services";export async function estimateLocationPriceController(req: Request, res: Response): Promise<void> {	try {		const { surfaceM2, numberOfBed, maxNumberOfPerson, country, locationType, locationGoodType } = req.body;				const estimatedPrice = await estimateLocationPrice({			surfaceM2,			numberOfBed,			maxNumberOfPerson,			country,			locationType: locationType as LocationType,			locationGoodType: locationGoodType as LocationGoodType		});				res.status(200).json({			message: 'Price estimated successfully',			estimatedPrice		});	} catch (error) {		if (error instanceof Error) {			console.error('Error estimating location price:', error);			res.status(400).json({ error: error.message });		} else {			console.error('An unknown error occurred:', error);			res.status(500).json({ error: 'An unknown error occurred' });		}	}}export async function saveLocationController(req: Request, res: Response): Promise<void> {	try {		const userId = (req as any).userId;				console.log('Received save location request:', req.body);				const savedLocation = await saveLocation({			surfaceM2: Number(req.body.surfaceM2),			numberOfBed: Number(req.body.numberOfBed),			maxNumberOfPerson: Number(req.body.maxNumberOfPerson),			country: req.body.country,			street: req.body.street,			locationType: req.body.locationType as LocationType,			locationGoodType: req.body.locationGoodType as LocationGoodType,			pricePerNight: Number(req.body.pricePerNight),			title: req.body.title,			description: req.body.description,			user: { connect: { id: userId } }		});				console.log('Location saved in controller:', savedLocation);				if (!savedLocation.id) {			throw new Error('Location saved but no id was returned');		}				res.status(201).json({			message: 'Location saved successfully',			location: {				id: savedLocation.id,				surfaceM2: savedLocation.surfaceM2,				numberOfBed: savedLocation.numberOfBed,				maxNumberOfPerson: savedLocation.maxNumberOfPerson,				country: savedLocation.country,				street: savedLocation.street,				locationType: savedLocation.locationType,				locationGoodType: savedLocation.locationGoodType,				pricePerNight: savedLocation.pricePerNight,				title: savedLocation.title,				description: savedLocation.description,				locationStatus: savedLocation.locationStatus			}		});	} catch (error) {		if (error instanceof Error) {			console.error('Error saving location:', error);			res.status(400).json({ error: error.message });		} else {			console.error('An unknown error occurred:', error);			res.status(500).json({ error: 'An unknown error occurred' });		}	}}export async function getLocationsToReviewController(req: Request, res: Response): Promise<void> {	try {		const locations = await getLocationsToReview();		res.status(200).json(locations);	} catch (error) {		console.error('Error fetching locations to review:', error);		res.status(500).json({ error: 'An error occurred while fetching locations' });	}}export async function getLocationController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const location = await getLocation(locationId);		if (!location) {			res.status(404).json({ error: 'Location not found' });			return;		}		res.status(200).json(location);	} catch (error) {		console.error('Error fetching location:', error);		res.status(500).json({ error: 'An error occurred while fetching the location' });	}}export async function uploadLocationImageControllerAsPaperAsset(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const file = req.file;		if (!file) {			res.status(400).json({ error: 'No file uploaded' });			return;		}		const updatedLocation = await uploadLocationImageAsPaperAsset(locationId, file);		res.status(200).json(updatedLocation);	} catch (error) {		console.error('Error uploading image:', error);		res.status(500).json({ error: 'An error occurred while uploading the image' });	}}export async function uploadLocationImageControllerAsImage(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const file = req.file;		if (!file) {			res.status(400).json({ error: 'No file uploaded' });			return;		}		const updatedLocation = await uploadLocationImageAsImage(locationId, file);		res.status(200).json(updatedLocation);	} catch (error) {		console.error('Error uploading image:', error);		res.status(500).json({ error: 'An error occurred while uploading the image' });	}}export async function completeLocationPaperworkController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const updatedLocation = await completeLocationPaperwork(locationId);		res.status(200).json(updatedLocation);	} catch (error) {		console.error('Error completing paperwork:', error);		res.status(500).json({ error: 'An error occurred while completing the paperwork' });	}}export async function removeDocumentController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.locationId);		const documentId = parseInt(req.params.documentId);		await removeDocument(locationId, documentId);		const updatedLocation = await getLocation(locationId);		res.status(200).json(updatedLocation);	} catch (error) {		console.error('Error removing document:', error);		res.status(500).json({ error: 'An error occurred while removing the document' });	}}export async function getLocationsPendingPublishController(req: Request, res: Response): Promise<void> {	console.log('Entering getLocationsPendingPublishController');	try {		console.log('Calling getLocationsPendingPublish');		const locations = await getLocationsPendingPublish();		console.log('Locations fetched:', locations);		res.status(200).json(locations);	} catch (error) {		console.error('Error fetching locations pending publish:', error);		res.status(500).json({ error: 'An error occurred while fetching locations' });	}}export async function publishLocationController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const updatedLocation = await publishLocation(locationId);		res.status(200).json(updatedLocation);	} catch (error) {		console.error('Error publishing location:', error);		res.status(500).json({ error: 'An error occurred while publishing the location' });	}}export async function registerPerksController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const perks = req.body.perks as PerkType[];		const updatedLocation = await registerLocationPerks(locationId, perks);		res.status(200).json(updatedLocation);	} catch (error) {		console.error('Error registering perks:', error);		res.status(500).json({ error: 'An error occurred while registering perks' });	}}export interface PublishedDocument {	id: number;	file: string; // Base64 encoded string	filename: string;	documentType: string;}export interface PublishedLocation {	id: number;	title: string;	pricePerNight: number;	surfaceM2: number;	maxNumberOfPerson: number;	country: string;	street: string;	locationType: string;	locationGoodType: string;	documents: PublishedDocument[];}export interface PublishedLocationById {	id: number;	title: string;	pricePerNight: number;	surfaceM2: number;	maxNumberOfPerson: number;	country: string;	street: string;	locationType: LocationType;	locationGoodType: LocationGoodType;	documents: PublishedDocument[];	perks: Perk[]}export async function getPublishedLocationsController(req: Request, res: Response): Promise<void> {	try {		const locations: PublishedLocation[] = await getPublishedLocations();		res.status(200).json(locations);	} catch (error) {		console.error('Error fetching published locations:', error);		res.status(500).json({ error: 'An error occurred while fetching published locations' });	}}export async function getUserPublishedLocationsController(req: Request, res: Response): Promise<void> {	try {		const userId = (req as any).userId;		const locations = await getUserPublishedLocations(userId);		res.status(200).json(locations);	} catch (error) {		console.error('Error fetching user\'s published locations:', error);		res.status(500).json({ error: 'An error occurred while fetching user\'s published locations' });	}}export async function getLocationDetailController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const location = await getLocationDetail(locationId);		res.status(200).json(location);	} catch (error) {		console.error('Error in getLocationDetailController:', error);		if (error instanceof Error && error.message === 'Location not found') {			res.status(404).json({ error: 'Location not found' });		} else {			res.status(500).json({ error: 'An error occurred while fetching the location' });		}	}}export async function getLocationReservationsController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const reservations = await getLocationReservations(locationId);		res.status(200).json(reservations);	} catch (error) {		console.error('Error in getLocationReservationsController:', error);		res.status(500).json({ error: 'An error occurred while fetching the reservations' });	}}export async function createReservationController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const { startDate, numberOfNights, numberOfPeople, isForRentor } = req.body;		const userId = (req as any).reservationUser.id;				const reservation = await createReservation({			locationId,			userId,			startDate: new Date(startDate),			numberOfNights,			numberOfPeople,			isForRentor,		});				res.status(201).json(reservation);	} catch (error) {		console.error('Error in createReservationController:', error);		if (error instanceof Error && error.message === 'Overlapping reservation') {			res.status(400).json({ error: 'The selected dates overlap with an existing reservation' });		} else {			res.status(500).json({ error: 'An error occurred while creating the reservation' });		}	}}export async function getRentorReservationsController(req: Request, res: Response): Promise<void> {	try {		const locationId = parseInt(req.params.id);		const userId = (req as any).userId; // Assuming you set this in your auth middleware		const reservations = await getRentorReservationsForLocation(locationId, userId);		res.status(200).json(reservations);	} catch (error) {		console.error('Error in getRentorReservationsController:', error);		res.status(500).json({ error: 'An error occurred while fetching the reservations' });	}}export async function deleteReservationController(req: Request, res: Response): Promise<void> {	try {		const reservationId = parseInt(req.params.reservationId);		const userId = (req as any).userId; // Assuming you set this in your auth middleware		await deleteReservation(reservationId, userId);		res.status(200).json({ message: 'Reservation deleted successfully' });	} catch (error) {		console.error('Error in deleteReservationController:', error);		res.status(500).json({ error: 'An error occurred while deleting the reservation' });	}}